!function(){function t(t){return $("<div>").text(t).html()}function e(t){return o.child(t)}function n(){a=location.hash.substr(1),u.id=window.localStorage.getItem("timeline.userid"),u.id?(c.get(u.id,function(t){u.name=t.username}),s.currentView=a?"account"==a?"account":"chat":"topics"):s.currentView="init"}var i=new MilkCocoa("https://io-si1g7tr3g.mlkcca.com:443/"),o=i.dataStore("topics"),c=i.dataStore("users"),a="",u={id:"",name:""},s=new Vue({el:"#content",data:{currentView:null}});Vue.component("topics",{template:"#topics-template",data:{topics:[],new_topic:""},filters:{topics_filter:function(t){return t}},ready:function(){this.fetch()},methods:{fetch:function(){var t=this;o.on("push",function(e){t.topics.push({topic_id:e.id,title:e.value.title,user:u})}),o.query({}).desc().done(function(e){e&&(t.topics=e.map(function(t){return{topic_id:t.id,title:t.title}}))})},create:function(){o.push({title:this.new_topic})},goto_chatroom:function(e){a=e,location.hash=t(a),s.currentView="chat"},goto_account:function(){location.hash="account",s.currentView="account"}}}),Vue.component("account",{template:"#account-template",data:{username:""},ready:function(){this.fetch()},methods:{fetch:function(){var t=this;c.get(u.id,function(e){t.username=e.username})},update:function(){var t=this;c.set(u.id,{username:t.username})}}}),Vue.component("init",{template:"#init-template",data:{username:""},ready:function(){},methods:{setting:function(){var t=this;c.push({username:t.username},function(t){window.localStorage.setItem("timeline.userid",t.id)}),s.currentView="topics"}}});Vue.component("chat",{template:"#chat-template",data:{title:"",messages:[],new_message:""},filters:{message_filter:function(t){return t}},ready:function(){this.fetch()},methods:{post:function(){e(a).push({content:t(this.new_message),user:u,timestamp:(new Date).getTime()}),this.new_memo=""},fetch:function(){var n=this;o.get(a,function(t){n.title=t.title}),e(a).on("push",function(e){n.messages.unshift({content:t(e.value.content),user:{name:t(e.value.user.name)}})}),e(a).query().sort("desc").limit(20).done(function(t){n.messages=t})}}});n(),window.onhashchange=function(){n()}}();